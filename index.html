<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>MoSPA</title>

	<script type="text/javascript" src="dist/mospa.js"></script>
	<script type="text/javascript">


		


		document.addEventListener('DOMContentLoaded', function(){

			var onloadHash = location.hash;

			window.app = mospa.createApplication('scrollapp', 'myapp',
				function(b){
					var ignoreNextNavigation = false;

					this.bind('page_change', function (e) {
						console.log(e);
						var n = e.data.newPage,
							o = e.data.oldPage,
							oBt, nBt;
						
						if(o != null) {
							oBt = document.querySelector('header>a[href="#/'+o.getSlug()+'"]');
							oBt.classList.remove('activated');
						}

						nBt = document.querySelector('header>a[href="#/'+n.getSlug()+'"]');
						nBt.classList.add('activated');

						if (!ignoreNextNavigation) { 

							this.hijackEvent('after_scroll', function (e) {});

							window.scroll(0, n.offset.topStart);

							setTimeout(function () {
								app.freeEvent('after_scroll');
							}, 50);
						}

						ignoreNextNavigation = false;
					});

					this.bind('after_scroll', function (e) {
						var visibles = e.data.visibility,
							l = visibles.length,
							bestX, x, newHash;

						for (x in visibles) {

							if (!bestX) {
								bestX = x;
							}

							if (!visibles.hasOwnProperty(x)) {
				                continue;
				            }

				            if (visibles[x].occupying + visibles[x].visible > visibles[bestX].occupying + visibles[bestX].visible) {		            	
			            		bestX = x;
			            	}

						}

						newHash = "#/" + bestX;

						if(location.hash.substring(0, newHash.length) !== newHash) {
							ignoreNextNavigation = true;
							location.hash = newHash;
						}
						
					});

				}
			);

			app.createPage(
				{
					slug		: "home", 
					domElement	: document.getElementById('home')
				},
				function(config){

					console.log('I\'m the home page');
					var dom = this.getDomElement();
					var bt = dom.getElementsByClassName('bt')[0];

					bt.addEventListener('click',function(){

						console.log('go to contact!!!');

					});

					this.bind('appeared', function(e){
						console.log('My name is HOME and I\'m visible now!!!', e)
					});

					this.bind('disappeared', function(e){
						console.log('HOME is invisible now!!!', e)
					});
				}
			);


			window.prodPage = app.createPage(
				{
					slug		: "products", 
					domElement	: document.getElementById('products')
				},
				function(config){

					console.log('I\'m the product page');
				
				}
			);

			prodPage.bind('hashchange',function(e){
				console.log(e);
			})

			app.createPage(
				{
					slug		: "about-us", 
					domElement	: document.getElementById('about-us')
				},
				function(config){

					console.log('I\'m the about-us page');	

				}
			);

			app.createPage(
				{
					slug		: "contact", 
					domElement	: document.getElementById('contact')
				},
				function(config){

					console.log('I\'m the contact page');
				
				}
			);			

			app.setCurrentPageByHash(onloadHash.split('/').slice(1)[0]);


		});

		

		


	</script>
	<style>

		header {
			position: fixed;
			z-index: 2;
			right: 100px;
			top: 100px;
			width: 100px;
		}

		header>* {
			width: 100%;
			display: block;
		}

		footer, #pageContainer>*{
			width: 500px;
			background:black;
			outline:2px solid red;
			margin: 0 auto;
			min-height:200px;
			color: white;
			text-align: center;
			box-sizing: border-box;
			padding: 50px;
		}

		#home {height:400px;}
		#products {height:800px;}
		#about-us {height:250px;}
		#contact {height:600px;}

		.bt {display:inline-block;border:1px solid red; line-height:50px;background:#999;cursor:pointer;text-decoration:none;padding:0 10px;color:#FFF;}
		.bt:hover{color:#F00;}
		.bt.activated{background:#333;border-color:green;}

	</style>
</head>

<body>

	<header>
		header<br/>

		<a href="#/home" class="bt">Home</a>
		<a href="#/products" class="bt">Products</a>
		<a href="#/about-us" class="bt">About Us</a>
		<a href="#/contact" class="bt">Contact</a>


	</header>

	<div id="pageContainer" style="position:relative">

		<section id="home">
			home
			<br/>
			<span class="bt">Go to Contacts</span>

		</section>

		<section id="products">
			products
			<br/><br/>
			<a href="#/products/category1/prod1" class="bt">Show product 1</a>

			<a href="#/products/category34/prod2" class="bt">Show product 2</a>

		</section>

		<section id="about-us">
			about-us
		</section>

		<section id="contact">
			contact
		</section>

	</div>

	<footer>
		footer
	</footer>


</body>
</html>
