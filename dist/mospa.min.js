!function(a){"use strict";"function"!=typeof Object.create&&!function(){var a=function(){};Object.create=function(b){if(arguments.length>1)throw new Error("Second argument not supported");if(null===b)throw new Error("Cannot set a null [[Prototype]]");if("object"!=typeof b)throw new TypeError("Argument must be an object");return a.prototype=b,new a}}();var b=function(){return{createApplication:function(a,c,d){var e,f=b.MosApplication;return!c&&(c={}),c.type=a,"scrollapp"===a?f=b.MosScrollApp:"slideapp"===a?f=b.MosSlideApp:a&&a.constructor===Function&&(f=a),e=new f(c),"function"==typeof d&&d.call(e,c),e}}}();a.mospa=b,b.Event=function(a,b,c,d){this.type=a,this.data=b,this.isStopped=!1,this.isFreezed=!1,this.freezedAt=0,this.eventList=d,this.context=c},b.Event.prototype.dispatchEvent=function(a){var b,c,d=this.eventList.length;for(b=a||0;d>b&&!this.isStopped;b+=1){if(this.isFreezed){this.freezedAt=b;break}if(null!==this.eventList[b]&&(c=this.eventList[b].callback.call(this.context,this),this.eventList[b]&&this.eventList[b].one&&(this.eventList[b]=null),c===!1))break}},b.Event.prototype.stop=function(){this.isStopped=!0},b.Event.prototype.freeze=function(){this.isFreezed=!0},b.Event.prototype.unfreeze=function(){this.isFreezed&&(this.isFreezed=!1,this.dispatchEvent(this.freezedAt))},b.EventHandler=function(){var a={},c={};this.bind=function(b,c,d){if(void 0===c)throw new Error("The second parameter of bind must be passed.");a[b]||(a[b]=[]),a[b].push({callback:c,one:d})},this.one=function(a,b){this.bind(a,b,!0)},this.unbind=function(b,c){var d,e,f=a[b];if(!f)return!1;for(e=f.length,d=0;e>d;d+=1)null===f[d]||f[d].callback!==c&&void 0!==c||(f[d]=null)},this.trigger=function(d,e){var f,g=a[d];return void 0===e&&(e={}),f=new b.Event(d,e,this,g),c[d]&&c[d].constructor===Function?(delete f.stopped,delete f.stop,c[d].call(this,f),!0):g?void f.dispatchEvent():!1},this.hijackEvent=function(a,b){c[a]=b},this.freeEvent=function(a){c[a]=null}},b.MosApplication=function(c){b.EventHandler.call(this);var d,e=[],f=this,g=null,h=null;c.history_mode||(c.history_mode="location_hash"),this.addPage=function(a){var d;if(a.constructor!==b.MosPage)throw new Error("The addPage first parameter must be a MosPage instance.");if(e.indexOf(a)>-1)throw new Error("This page is already in this application.");for(d=0;d<e.length;d+=1)if(e[d].getSlug()===a.getSlug())throw new Error('The slug "'+a.getSlug()+'" is already used in this application ('+c.id+").");return a.application=this,e.push(a),this.trigger("pageadded",{page:a}),!0},this.getPages=function(){return e.concat()},this.countPages=function(){return e.length},this.getPageBySlug=function(a){var b,c=e.length;for(b=0;c>b;b+=1)if(e[b].getSlug()===a)return e[b];return null},this.getCurrentPage=function(){return h},this.setCurrentPageByHash=function(a){var b=this.getPageBySlug(a);b&&this.setCurrentPage(b)},this.setCurrentPage=function(a){return h===a?!1:(this.trigger("page_change",{oldPage:h,newPage:a}),void(h=a))},"pushstate"===c.history_mode?(a.onpopstate&&(d=a.onpopstate),a.onpopstate=function(a){alert("location: "+document.location+", state: "+JSON.stringify(a.state)),d(a)}):"location_hash"===c.history_mode&&a.addEventListener("hashchange",function(){var a,b=location.hash.split("/").slice(1);if(null!==g&&b.join("/")===g.join("/"))f.setCurrentPageByHash(b[0]);else if(null!==g&&b[0]===g[0])h.trigger("hashchange",b);else for(a=0;a<e.length;a+=1)if(e[a].getSlug()===b[0]){g=b,f.setCurrentPage(e[a]);break}},!1)},b.MosApplication.prototype.createPage=function(a,c){var d=new b.MosPage(a);return"function"==typeof c&&c.call(d,a),this.addPage(d),d},b.MosPage=function(a){b.EventHandler.call(this);var c,d;if(void 0===a)throw new Error("A configuration objective is required to create a new MosPage");if(void 0===a.slug)throw new Error("The config slug property is required");if(void 0===a.domElement)throw new Error("The config domElement property is required");this.application=null,c=a.slug,d=a.domElement,this.getSlug=function(){return c},this.getDomElement=function(){return d}},b.MosScrollApp=function(c){this.constructor.call(this,c);var d=this,e={},f=c.offsetParent||a,g=0,h={},i=null,j=0,k=c.visibilityCalcThrottle||!1,l=function(c){var d,h,i,j,k,m,n;if(g=f.offsetHeight||f.innerHeight||0,c){if(c.constructor===b.MosPage){for(k=c.getDomElement(),m=k.offsetParent||a,n=0;m!=f&&m!=a;)n+=m.offsetTop||0,m=m.offsetParent||a;j={begin:n+k.offsetTop},j.end=j.begin+k.offsetHeight,e[c.getSlug()]=j,c.offset={topStart:j.begin,topEnd:j.end}}}else for(e={},i=this.getPages(),h=i.length,d=0;h>d;d+=1)l(i[d])};this.bind("pageadded",function(a){{var b=a.data.page;b.getDomElement()}b.offset=null,l.call(this,b)}),this.calculateVisibility=function(a){var b,c,l,m,n,o,p,q=f.scrollTop||f.scrollY||0,r=q+g,s=(new Date).getTime(),t={},u="stopped";if(!(a&&k&&k>s-j)){j=s,null!==i&&(i>q?u="up":q>i&&(u="down"));for(p in e)e.hasOwnProperty(p)&&(b=e[p].begin,c=e[p].end,l=m=0,q>b&&q>c||b>r&&c>r||(n=b,o=c,q>n&&(n=q),o>r&&(o=r),l=(o-n)/(r-q),m=(o-n)/(c-b),t[p]={occupying:l,visible:m}));for(p in h)t.hasOwnProperty(p)||d.getPageBySlug(p).trigger("disappeared",{scrollDirection:u});for(p in t)h.hasOwnProperty(p)?d.getPageBySlug(p).trigger("when_visible",{scrollDirection:u,visibility:t[p]}):(d.getPageBySlug(p).trigger("appeared",{scrollDirection:u}),d.getPageBySlug(p).trigger("when_visible",{scrollDirection:u,visibility:t[p]}));return d.trigger("after_scroll",{scrollDirection:u,visibility:t}),h=t,i=q,t}},a.addEventListener("resize",function(){l.call(d),d.calculateVisibility()}),f.addEventListener("scroll",function(){d.calculateVisibility(!0)}),this.recalcOffsets=l},b.MosScrollApp.prototype=Object.create(b.MosApplication.prototype),b.MosSlideApp=function(c){function d(a){var b,c=a.wheelDeltaY||a.wheelDelta||-a.deltaY||-a.detail,d=(f.getCurrentPage(),i);if(l||(clearTimeout(e),e=setTimeout(function(){m=!1},250)),l||!m){if(j)return void(l||(m=!0));c>0?d-=1:0>c&&(d+=1),d=Math.max(0,d),d=Math.min(h-1,d),d!==i&&(b=k[d],f.setCurrentPage(k[d]))}}this.constructor.call(this,c);var e,f=this,g=c.wrapper||a,h=0,i=0,j=!1,k=[],l=c.allowInertia,m=!1;this.bind("pageadded",function(a){{var b=a.data.page;b.getDomElement()}k=this.getPages(),h=k.length}),this.bind("page_change",function(a){var c=a.data.oldPage,d=a.data.newPage,e=function(){j=!1};i=k.indexOf(a.data.newPage),j=!0,c instanceof b.MosPage?(c.one("transition_out",function(a){d instanceof b.MosPage&&(d.one("transition_in",e),d.trigger("transition_in",a.data))}),c.trigger("transition_out",a.data)):d instanceof b.MosPage&&(d.one("transition_in",e),d.trigger("transition_in",a.data))}),g.addEventListener("mousewheel",d),g.addEventListener("DOMMouseScroll",d)},b.MosSlideApp.prototype=Object.create(b.MosApplication.prototype)}(this);