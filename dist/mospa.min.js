!function(a){"use strict";"function"!=typeof Object.create&&!function(){var a=function(){};Object.create=function(b){if(arguments.length>1)throw new Error("Second argument not supported");if(null===b)throw new Error("Cannot set a null [[Prototype]]");if("object"!=typeof b)throw new TypeError("Argument must be an object");return a.prototype=b,new a}}();var b=function(){return{createApplication:function(a,c,d){var e,f=b.MosApplication;return!c&&(c={}),c.type=a,"scrollapp"===a?f=b.MosScrollApp:a&&a.constructor===Function&&(f=a),e=new f(c),"function"==typeof d&&d.call(e,c),e}}}();a.mospa=b,b.EventHandler=function(){var a={},b={};this.bind=function(b,c,d){if(void 0===c)throw new Error("The second parameter of bind must be passed.");a[b]||(a[b]=[]),a[b].push({callback:c,one:d})},this.one=function(a,b){this.bind(a,b,!0)},this.unbind=function(b,c){var d,e,f=a[b];if(!f)return!1;for(e=f.length,d=0;e>d;d+=1)null===f[d]||f[d].callback!==c&&void 0!==c||(f[d]=null)},this.trigger=function(c,d){var e,f,g,h,i=a[c];if(void 0===d&&(d={}),e={stopped:!1,stop:function(){this.stopped=!0},data:d},b[c]&&b[c].constructor===Function)return delete e.stopped,delete e.stop,b[c].call(this,e),!0;if(!i)return!1;for(h=i.length,g=0;h>g&&!e.stopped&&(null===i[g]||(f=i[g].callback.call(this,e),i[g]&&i[g].one&&(i[g]=null),f!==!1));g+=1);},this.hijackEvent=function(a,c){b[a]=c},this.freeEvent=function(a){b[a]=null}},b.MosApplication=function(c){b.EventHandler.call(this);var d=[],e=this,f=null,g=null;c.history_mode||(c.history_mode="location_hash"),this.addPage=function(a){var e;if(a.constructor!==b.MosPage)throw new Error("The addPage first parameter must be a MosPage instance.");if(d.indexOf(a)>-1)throw new Error("This page is already in this application.");for(e=0;e<d.length;e+=1)if(d[e].getSlug()===a.getSlug())throw new Error('The slug "'+a.getSlug()+'" is already used in this application ('+c.id+").");return a.application=this,d.push(a),this.trigger("pageadded",{page:a}),!0},this.getPages=function(){return d.concat()},this.getPageBySlug=function(a){var b,c=d.length;for(b=0;c>b;b+=1)if(d[b].getSlug()===a)return d[b];return null},this.getCurrentPage=function(){return g},this.setCurrentPageByHash=function(a){var b=this.getPageBySlug(a);b&&this.setCurrentPage(b)},this.setCurrentPage=function(a){this.trigger("page_change",{oldPage:g,newPage:a}),g=a},"location_hash"===c.history_mode&&a.addEventListener("hashchange",function(){var a,b=location.hash.split("/").slice(1);if(null!==f&&b.join("/")===f.join("/"));else if(null!==f&&b[0]===f[0])g.trigger("hashchange",b);else for(a=0;a<d.length;a+=1)if(d[a].getSlug()===b[0]){f=b,e.setCurrentPage(d[a]);break}},!1)},b.MosApplication.prototype.createPage=function(a,c){var d=new b.MosPage(a);return"function"==typeof c&&c.call(d,a),this.addPage(d),d},b.MosPage=function(a){b.EventHandler.call(this);var c,d;if(void 0===a)throw new Error("A configuration objective is required to create a new MosPage");if(void 0===a.slug)throw new Error("The config slug property is required");if(void 0===a.domElement)throw new Error("The config domElement property is required");this.application=null,c=a.slug,d=a.domElement,this.getSlug=function(){return c},this.getDomElement=function(){return d}},b.MosScrollApp=function(c){this.constructor.call(this,c);var d=this,e={},f=c.offsetParent||null,g={},h=null,i=function(a){var c,d,g,h,j,k,l;if(a){if(a.constructor===b.MosPage){for(j=a.getDomElement(),k=j.offsetParent,l=0;k!=f&&k!=document.body;)l+=k.offsetTop,k=k.offsetParent;h={begin:l+j.offsetTop},h.end=h.begin+j.offsetHeight,e[a.getSlug()]=h,a.offset={topStart:h.begin,topEnd:h.end}}}else for(e={},g=this.getPages(),d=g.length,c=0;d>c;c+=1)i(g[c])};this.bind("pageadded",function(a){var b=a.data.page,c=b.getDomElement();null===f?f=c.offsetParent:c.offsetParent!==f&&console.warn("OffsetParent inconsistency! Some pages have different offsetParents. It can cost more process to calculate the pages visibility."),b.offset=null,i.call(this,b)}),this.calculateVisibility=function(){var b,c,f,i,j,k,l,m=document.body.scrollTop,n=m+a.innerHeight,o={},p="stopped";null!==h&&(h>m?p="up":m>h&&(p="down"));for(l in e)e.hasOwnProperty(l)&&(b=e[l].begin,c=e[l].end,f=i=0,m>b&&m>c||b>n&&c>n||(j=b,k=c,m>j&&(j=m),k>n&&(k=n),f=(k-j)/(n-m),i=(k-j)/(c-b),o[l]={occupying:f,visible:i}));for(l in g)o.hasOwnProperty(l)||d.getPageBySlug(l).trigger("disappeared",{scrollDirection:p});for(l in o)g.hasOwnProperty(l)?d.getPageBySlug(l).trigger("when_visible",{scrollDirection:p,visibility:o[l]}):(d.getPageBySlug(l).trigger("appeared",{scrollDirection:p}),d.getPageBySlug(l).trigger("when_visible",{scrollDirection:p,visibility:o[l]}));return d.trigger("after_scroll",{scrollDirection:p,visibility:o}),g=o,h=m,o},a.addEventListener("resize",function(){i.call(d),d.calculateVisibility()}),a.addEventListener("scroll",function(){d.calculateVisibility()})},b.MosScrollApp.prototype=Object.create(b.MosApplication.prototype)}(this);