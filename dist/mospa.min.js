var EventHandler=function(){"use strict";var a={};this.bind=function(b,c,d){if(void 0===c)throw new Error("The second parameter of bind must be passed.");a[b]||(a[b]=[]),a[b].push({callback:c,one:d})},this.one=function(a,b){this.bind(a,b,!0)},this.unbind=function(b,c){var d,e,f=a[b];if(!f)return!1;for(e=f.length,d=0;e>d;d+=1)null===f[d]||f[d].callback!==c&&void 0!==c||(f[d]=null)},this.trigger=function(b,c){var d,e,f,g,h=a[b];if(!h)return!1;for(g=h.length,void 0===c&&(c={}),d={stopped:!1,stop:function(){this.stopped=!0},data:c},f=0;g>f&&!d.stopped&&(null===h[f]||(e=h[f].callback.call(this,d),h[f].one&&(h[f]=null),e!==!1));f+=1);}},MosApplication=function(a){"use strict";EventHandler.call(this);var b=[],c=this,d=null,e=null;this.addPage=function(c){var d;if(c.constructor!==MosPage)throw new Error("The addPage first parameter must be a MosPage instance.");if(b.indexOf(c)>-1)throw new Error("This page is already in this application.");for(d=0;d<b.length;d+=1)if(b[d].getSlug()===c.getSlug())throw new Error('The slug "'+c.getSlug()+'" is already used in this application ('+a.id+").");return c.application=this,b.push(c),this.trigger("pageadded",{page:c}),!0},this.getPages=function(){return b.concat()},this.getPageBySlug=function(a){var c,d=b.length;for(c=0;d>c;c+=1)if(b[c].getSlug()===a)return b[c];return null},this.getCurrentPage=function(){return e},this.setCurrentPage=function(a){this.trigger("pagechange",{oldPage:e,newPage:a}),e=a},window.addEventListener("hashchange",function(){var a,f=location.hash.split("/").slice(1);if(null!==d&&f.join("/")===d.join("/"));else if(null!==d&&f[0]===d[0])e.trigger("hashchange",f);else for(a=0;a<b.length;a+=1)if(b[a].getSlug()===f[0]){d=f,c.setCurrentPage(b[a]);break}},!1)};MosApplication.prototype.createPage=function(a,b){"use strict";var c=new MosPage(a);return"function"==typeof b&&b.call(c,a),this.addPage(c),c};var MosPage=function(a){"use strict";EventHandler.call(this);var b,c;if(void 0===a)throw new Error("A configuration objective is required to create a new MosPage");if(void 0===a.slug)throw new Error("The config slug property is required");if(void 0===a.domElement)throw new Error("The config domElement property is required");this.application=null,b=a.slug,c=a.domElement,this.getSlug=function(){return b},this.getDomElement=function(){return c}},MosScrollApp=function(a){"use strict";this.constructor.call(this,a);var b=this,c={},d=null,e={},f=null,g=function(a){for(var b,e,f,g,h=d,i=0;h!=document.body;)i+=h.offsetTop,h=h.offsetParent;if(a)a.constructor===MosPage&&(g={begin:i+a.getDomElement().offsetTop},g.end=g.begin+a.getDomElement().offsetHeight,c[a.getSlug()]=g);else for(c={},f=this.getPages(),e=f.length,b=0;e>b;b+=1)g={begin:i+f[b].getDomElement().offsetTop},g.end=g.begin+f[b].getDomElement().offsetHeight,c[f[b].getSlug()]=g};this.bind("pageadded",function(a){var b=a.data.page,c=b.getDomElement();null===d?d=c.offsetParent:c.offsetParent!==d&&console.error("OffsetParent inconsistency! Some pages have different offsetParents."),g.call(this,b)}),this.bind("windowresize",function(){g.call(this)}),window.addEventListener("scroll",function(){var a,d,g,h,i,j,k,l=document.body.scrollTop,m=l+window.innerHeight,n={},o="stopped";null!==f&&(f>l?o="up":l>f&&(o="down"));for(k in c)c.hasOwnProperty(k)&&(a=c[k].begin,d=c[k].end,g=h=0,l>a&&l>d||a>m&&d>m||(i=a,j=d,l>i&&(i=l),j>m&&(j=m),g=(j-i)/(m-l),h=(j-i)/(d-a),n[k]={occupying:g,visible:h}));for(k in e)n.hasOwnProperty(k)||b.getPageBySlug(k).trigger("disappeared",{scrollDirection:o});for(k in n)e.hasOwnProperty(k)||b.getPageBySlug(k).trigger("appeared",{scrollDirection:o});e=n,f=l})};MosScrollApp.prototype=Object.create(MosApplication.prototype),"function"!=typeof Object.create&&!function(){"use strict";var a=function(){};Object.create=function(b){if(arguments.length>1)throw new Error("Second argument not supported");if(null===b)throw new Error("Cannot set a null [[Prototype]]");if("object"!=typeof b)throw new TypeError("Argument must be an object");return a.prototype=b,new a}}();var mospa=function(){"use strict";return{createApplication:function(a,b,c){var d,e,f;return"scrollapp"===a&&(d=MosScrollApp),f={type:a,id:b},e=new d(f),"function"==typeof c&&c.call(e,f),e}}}();